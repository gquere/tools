#!/bin/bash
# GQ, 2013, gquere/ece.fr

WRAP=$((`tput cols` - 15))

print_long_line() {
#	echo "    "$line | sed -r "s/(.{$WRAP})/\1\n      /g"
	echo -n "  "
	python /bin/mpr_print_line.py "$line"
}

while read line; do
	if [[ "$line" =~ " error" || "$line" =~ Error || "$line" =~ Interrupt ]]; then
		echo -ne '\e[41m'
		echo -n "$line"
		echo -e '\e[0m'
	elif [[ "$line" =~ warning || "$line" =~ Warning || "$line" =~ WARNING ]]; then
		echo -ne '\e[1;33m'"    "$line
		echo -e '\e[0m'
	elif [[ "$line" =~ ^make ]]; then
		echo -ne '\e[1;34m'
		echo -n "$line"
		echo -e '\e[0m'
	elif [[ "$line" =~ ^Maki ]]; then
		echo -ne '\e[1;32m'$line
		echo -e '\e[0m'
	elif [[ "$line" =~ *"In function"* ]]; then
		echo "    "$line
	elif [[ "$line" =~ ^Compiling || "$line" =~ ^Linking ]]; then
		echo -ne '\e[1;37m'"  "$line
		echo -e '\e[0m'
	elif [[ "$line" =~ ^\. || "$line" =~ ^gcc || "$line" =~ ^ld ]]; then
		if [[ ${#line} -lt $WRAP ]]; then
			echo "    "$line
		else
			print_long_line
		fi
	else
	#	echo "  $line"
		print_long_line
	fi
done
